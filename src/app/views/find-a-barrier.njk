{% from 'components/select/macro.njk' import govukSelect %}
{% from 'app-components/heading.njk' import heading %}
{% from 'app-components/multiselect.njk' import multiselect %}

{% extends 'layout.njk' %}

{% block page_title %}{{ super() }} - Find a barrier{% endblock %}

{% block body_script %}
	<script>
		ma.pages.findABarrier();
	</script>
{% endblock %}

{% block page_content %}

	{{ heading({
		caption: 'Market access barriers',
		text: 'Find a barrier'
	}) }}

	<section class="govuk-grid-row">
		<div class="govuk-grid-column-one-quarter">
			<h2 class="filter-list-title">Filter barriers by:</h2>
			<form action="{{ urls.findABarrier() }}" method="GET" class="filter-items">

				{{ govukSelect({
					id: 'country',
					name: 'country',
					classes: 'govuk-!-width-full js-filter',
					formGroup: {
						classes: 'filter-items-group'
					},
					label: {
						text: 'Barrier location',
						classes: 'filter-items__label'
					},
					items: filters.country
				}) }}

				{{ govukSelect({
					id: 'sector',
					name: 'sector',
					classes: 'govuk-!-width-full js-filter',
					formGroup: {
						classes: 'filter-items-group'
					},
					label: {
						text: 'Sector',
						classes: 'filter-items__label'
					},
					items: filters.sector
				}) }}

				{{ govukSelect({
					id: 'type',
					name: 'type',
					classes: 'govuk-!-width-full js-filter',
					formGroup: {
						classes: 'filter-items-group'
					},
					label: {
						text: 'Barrier type',
						classes: 'filter-items__label'
					},
					items: filters.type
				}) }}

				{{ multiselect({
					id: 'priority',
					name: 'priority',
					classes: 'govuk-!-width-full multiselect multiselect--smaller multiselect--light multiselect--filter js-filter-group',
					formGroup: {
						classes: 'filter-group'
					},
					fieldset: {
						classes: 'filter-group__inner',
						legend: {
							text: "Barrier priority",
							classes: "filter-items__label filter-group__label"
						}
					},
					items: filters.priority
				})	}}

				{% if hasFilters %}
				<a class="filter-items__clear js-filter-clear" href="{{ urls.findABarrier() }}">Clear filters</a>
				{% endif %}

				<input type="submit" value="Apply filters" class="govuk-button govuk-button--full-width js-filter-submit">
			</form>
		</div>
		<div class="govuk-grid-column-three-quarters">

			<h2 class="filter-results-title">{{ count }} <span class="filter-results-title__caption">barrier{{ 's' if count != 1 }}</span></h2>
			<ol class="filter-results-list">
				{% for barrier in barriers %}
					<li class='filter-results-list__item'>
						<div class="filter-results-list__item__main-content">
							<h3 class='filter-results-list__item__heading'><a href="{{ urls.barriers.detail( barrier.id ) }}">{{ barrier.title }}</a></h3>
							<dl class="filter-results-list__item__definitions">
								{% if barrier.sectors.length %}
								<dt class="filter-results-list__item__definitions__key">Sector{{ 's' if barrier.sectorsList.length != 1 }} affected:</dt>
								<dd class="filter-results-list__item__definitions__value">{{ barrier.sectorsList | join( ', ' ) }}</dd>
								{% endif %}
								<dt class="filter-results-list__item__definitions__key">Barrier location:</dt>
								<dd class="filter-results-list__item__definitions__value">{{ barrier.country.name }}</dd>
							</dl>
						</div>

						<ul class="filter-results-list__item__sub-content">
							<li class="filter-results-list__item__sub-content__item">
								<span class="barrier-status-badge barrier-status-badge--compact barrier-status-badge--{{ barrier.status.modifyer }}">
									<strong>{{ barrier.status.name }}</strong>
								</span>
							</li>
							<li class="filter-results-list__item__sub-content__item">
								<span class="visually-hidden">ID: </span>{{ barrier.code }}
							</li>
							<li class="filter-results-list__item__sub-content__item">
								<span class="muted">Added </span>{{ barrier.date.reported | dateOnly }}
							</li>
						</ul>
					</li>
				{% endfor %}
			</ol>
		</div>
	</section>

{% endblock %}
